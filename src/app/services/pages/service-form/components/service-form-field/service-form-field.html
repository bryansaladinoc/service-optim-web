<div class="flex justify-around gap-10 mt-5">
  <div class="flex flex-col gap-5 flex-2/3">
    <form
      id="myForm"
      class="bg-white rounded-md p-5"
      [formGroup]="form"
      (ngSubmit)="save()"
    >
      <div class="flex gap-5 items-center justify-between mb-7">
        <div class="flex flex-col gap-2 grow">
          <label>Fecha del servicio</label>
          <p-datepicker
            dateFormat="dd/mm/yy"
            class="w-full"
            formControlName="serviceDate"
          />
          <small id="date-help"
            >Ingresa la fecha en que se realiza el servicio</small
          >
        </div>

        <div class="flex flex-col gap-2 grow">
          <label>Fecha del siguiente servicio</label>
          <p-datepicker
            dateFormat="dd/mm/yy"
            class="w-full"
            formControlName="serviceNextDate"
          />
          <small id="next-date-help"
            >Ingresa la siguiente fecha en que se realiza el servicio</small
          >
        </div>
      </div>

      <div class="flex gap-5 items-center justify-between">
        <div class="flex flex-col gap-2 grow">
          <label>Cliente</label>
          <p-select
            [options]="clients()"
            [filter]="true"
            [filterFields]="['name', 'clientNumber']"
            [virtualScroll]="true"
            [virtualScrollItemSize]="38"
            optionLabel="name"
            placeholder="Selecciona un cliente"
            class="w-full"
            formControlName="client"
          >
            <ng-template #item let-item>
              {{item.clientNumber}} - {{item.name }}
            </ng-template>
            <ng-template #selectedItem let-selectedOption>
              <div class="flex items-center gap-2">
                <div>
                  {{selectedOption.clientNumber}} - {{selectedOption.name }}
                </div>
              </div>
            </ng-template>
          </p-select>
          <small>Selecciona el cliente al que se realizara el servicio</small>
        </div>

        <div class="flex flex-col gap-2 grow">
          <!-- <label>Tipo</label>
          <p-select
            [options]="serviceTypes"
            optionLabel="name"
            placeholder="Selecciona un tipo de servicio"
            class="w-full"
            formControlName="serviceType"
          />
          <small>Selecciona el tipo de servicio a realizar</small> -->
        </div>
      </div>
    </form>

    <!-- Equipos asignados al cliente -->
    <section class="bg-white p-5 rounded-md">
      <span class="text-lg font-bold">Equipos asignados al cliente</span>

      <div class="mt-5 flex gap-5">
        <div class="flex flex-col gap-2 grow">
          <label>Equipo</label>
          <p-select
            [options]="products()"
            [filter]="true"
            [filterFields]="['description', 'productNumber']"
            [virtualScroll]="true"
            [virtualScrollItemSize]="38"
            optionLabel="description"
            placeholder="Selecciona un equipo"
            class="w-full"
            [(ngModel)]="productSelected"
          >
            <ng-template #item let-item>
              {{item.productNumber}} - {{item.description }}
            </ng-template>
            <ng-template #selectedItem let-selectedOption>
              <div class="flex items-center gap-2">
                <div>
                  {{selectedOption.productNumber}} -
                  {{selectedOption.description }}
                </div>
              </div>
            </ng-template>
          </p-select>
          <small>Selecciona el equipo asignado al cliente</small>
        </div>

        <div class="flex flex-col gap-2">
          <label for="username">Cantidad</label>
          <input
            pInputText
            type="number"
            id="username"
            aria-describedby="username-help"
            [value]="quantity()"
            (input)="quantity.set(+$any($event.target).value)"
          />
          <small id="username-help"
            >Ingresa cuandos equipos tiene el cliente</small
          >
        </div>
      </div>

      <div class="my-5 flex justify-end">
        <p-button
          [disabled]="!productSelected || quantity() <= 0"
          label="Agregar"
          aria-label="Add"
          routerLink="new"
          icon="pi pi-plus"
          (onClick)="addProduct(productSelected!)"
        />
      </div>

      <p-table
        [columns]="tableCols"
        [value]="assignedProducts"
        [tableStyle]="{ 'min-width': '50rem' }"
      >
        <ng-template #header let-columns>
          <tr>
            @for (col of columns; track col.header) {
            <th>{{ col.header }}</th>
            }
          </tr>
        </ng-template>
        <ng-template #body let-item>
          <tr>
            <td>{{item?.productNumber}}</td>
            <td>{{item?.description}}</td>
            <td>{{item?.quantity}}</td>
          </tr>
        </ng-template>
      </p-table>
    </section>
  </div>

  <div class="flex-1/3 relative">
    <section class="flex flex-col gap-5 bg-white rounded-md p-5 sticky top-20">
      <span class="text-xl font-bold text-blue-500">Resum√©n del servicio</span>

      <div>
        <label class="font-bold">Fecha del servicio:&nbsp;</label>
        <span>{{serviceDateField | date : 'dd/MM/yyy'}}</span>
      </div>

      <div>
        <label class="font-bold">Fecha del siguiente servicio:&nbsp;</label>
        <span>{{serviceNextDateField | date : 'dd/MM/yyy'}}</span>
      </div>

      <div>
        <label class="font-bold">Cliente:&nbsp;</label>
        <span>{{clientField?.name}}</span>
      </div>

      <!-- <div>
        <label class="font-bold">Tipo de servicio:&nbsp;</label>
        <span>{{serviceTypeField?.name}}</span>
      </div> -->
    </section>

    <section class="flex mt-5 justify-end sticky top-81">
      <div class="mt-auto">
        <button
          pButton
          form="myForm"
          type="submit"
          [label]="serviceData() ? 'Guardar cambios' : 'Crear servicio'"
          icon=""
          aria-label="Save"
          routerLink="new"
        ></button>
      </div>
    </section>
  </div>
</div>
